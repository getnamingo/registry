{% extends "layouts/app.twig" %}

{% block title %}{{ __('Create Registrar') }}{% endblock %}

{% block content %}
      <div class="page-wrapper">
        <!-- Page header -->
        <div class="page-header d-print-none">
          <div class="container-xl">
            <div class="row g-2 align-items-center">
              <div class="col">
                <!-- Page pre-title -->
                <div class="page-pretitle">
                  {{ __('Overview') }}
                </div>
                <h2 class="page-title">
                  {{ __('Create Registrar') }}
                </h2>
              </div>
            </div>
          </div>
        </div>
        <!-- Page body -->
        <div class="page-body">
          <div class="container-xl">
            <div class="col-12">
            {% include 'partials/flash.twig' %}
              <form action="/registrar/create" method="post" autocomplete="off">
              {{ csrf.field | raw }}
                <!-- Registrar Details Card -->
                <div class="card mb-3">
                  <div class="card-body">
                    <h5 class="card-title">{{ __('Registrar Details') }}</h5>
                      <div class="row">
                        <!-- First Column -->
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="name" class="form-label required">{{ __('Name') }}</label>
                            <input type="text" class="form-control" id="name" name="name" required>
                            <small class="text-muted">{{ __('The official name of the registrar.') }}</small>
                          </div>
                          <div class="mb-3">
                            <label for="ianaId" class="form-label">IANA ID</label>
                            <input type="number" class="form-control" id="ianaId" name="ianaId">
                            <small class="text-muted">{{ __('Unique identifier assigned by IANA.') }}</small>
                          </div>
                          <div class="mb-3">
                            <label for="email" class="form-label required">{{ __('Email') }}</label>
                            <input type="text" class="form-control" id="email" name="email" required autocapitalize="none">
                            <small class="text-muted">{{ __('Primary contact email of the registrar.') }}</small>
                          </div>
                          <div class="mb-3">
                            <label for="url" class="form-label required">{{ __('URL') }}</label>
                            <input type="text" class="form-control" id="url" name="url" required autocapitalize="none">
                            <small class="text-muted">{{ __('Registrar\'s official website URL.') }}</small>
                          </div>
                        </div>

                        <!-- Second Column -->
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="whoisServer" class="form-label required">{{ __('WHOIS Server') }}</label>
                            <input type="text" class="form-control" id="whoisServer" name="whoisServer" required autocapitalize="none">
                            <small class="text-muted">{{ __('Address of the registrar\'s WHOIS server.') }}</small>
                          </div>
                          <div class="mb-3">
                            <label for="rdapServer" class="form-label required">{{ __('RDAP Server') }}</label>
                            <input type="text" class="form-control" id="rdapServer" name="rdapServer" required autocapitalize="none">
                            <small class="text-muted">{{ __('Address of the registrar\'s RDAP server.') }}</small>
                          </div>
                          <div class="mb-3">
                            <label for="abuseEmail" class="form-label required">{{ __('Abuse Email') }}</label>
                            <input type="text" class="form-control" id="abuseEmail" name="abuseEmail" required autocapitalize="none">
                            <small class="text-muted">{{ __('Email address for reporting abuse.') }}</small>
                          </div>
                          <div class="mb-3">
                            <label for="abusePhone" class="form-label required">{{ __('Abuse Phone') }}</label>
                            <input type="tel" class="form-control" id="abusePhone" name="abusePhone" required>
                            <small class="text-muted">{{ __('Phone number for reporting abuse.') }}</small>
                          </div>
                        </div>
                      </div>
                  </div>
                </div>

                <!-- Financial Information Card -->
                <div class="card mb-3">
                  <div class="card-body">
                    <h5 class="card-title">{{ __('Financial Information') }}</h5>
                      <div class="row">
                        <!-- First Column -->
                        <div class="col-md-4">
                          <div class="mb-3">
                            <label for="accountBalance" class="form-label required">{{ __('Account Balance') }}</label>
                            <input type="number" step="0.01" class="form-control" id="accountBalance" name="accountBalance" value="0" required>
                            <small class="text-muted">{{ __('Current balance in the registrar\'s account.') }}</small>
                          </div>
                          <div class="mb-3">
                            <label for="creditLimit" class="form-label required">{{ __('Credit Limit') }}</label>
                            <input type="number" step="0.01" class="form-control" id="creditLimit" name="creditLimit" value="0" required>
                            <small class="text-muted">{{ __('Maximum credit limit for the registrar.') }}</small>
                          </div>
                        </div>

                        <!-- Second Column -->
                        <div class="col-md-4">
                          <div class="mb-3">
                            <label for="creditThreshold" class="form-label required">{{ __('Credit Threshold') }}</label>
                            <input type="number" step="0.01" class="form-control" id="creditThreshold" name="creditThreshold" required>
                            <small class="text-muted">{{ __('Credit threshold triggering alerts or actions.') }}</small>
                          </div>
                          <div class="mb-3">
                            <label for="thresholdType" class="form-label required">{{ __('Threshold Type') }}</label>
                            <select class="form-select" id="thresholdType" name="thresholdType" required>
                              <option value="fixed">{{ __('Fixed') }}</option>
                              <option value="percent">{{ __('Percent') }}</option>
                            </select>
                            <small class="text-muted">{{ __('Type of threshold: fixed value or percentage.') }}</small>
                          </div>
                        </div>
                        
                        <!-- Third Column -->
                        <div class="col-md-4">
                          <div class="mb-3">
                            <label for="companyNumber" class="form-label required">{{ __('Company Number') }}</label>
                            <input type="text" class="form-control" id="companyNumber" name="companyNumber" required>
                            <small class="text-muted">{{ __('Official registration number provided by the relevant authority.') }}</small>
                          </div>
                          <div class="mb-3">
                            <label for="vatNumber" class="form-label">{{ __('VAT Number') }}</label>
                            <input type="text" class="form-control" id="vatNumber" name="vatNumber">
                            <small class="text-muted">{{ __('VAT number for tax purposes, if registered for VAT.') }}</small>
                          </div>
                        </div>
                      </div>
                  </div>
                </div>

                <!-- Registrar Contacts Section with Tabs -->
                <div class="card mb-3">
                  <div class="card-body">
                    <h5 class="card-title">{{ __('Registrar Contacts') }}</h5>
                    <ul class="nav nav-tabs nav-fill" id="contactTabs" role="tablist">
                      <!-- Tab Headers -->
                      <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="owner-tab" data-bs-toggle="tab" data-bs-target="#owner" type="button" role="tab" aria-controls="owner" aria-selected="true">{{ __('Owner') }}</button>
                      </li>
                      <li class="nav-item" role="presentation">
                        <button class="nav-link" id="billing-tab" data-bs-toggle="tab" data-bs-target="#billing" type="button" role="tab" aria-controls="billing" aria-selected="false">{{ __('Billing') }}</button>
                      </li>
                      <li class="nav-item" role="presentation">
                        <button class="nav-link" id="abuse-tab" data-bs-toggle="tab" data-bs-target="#abuse" type="button" role="tab" aria-controls="abuse" aria-selected="false">{{ __('Abuse') }}</button>
                      </li>
                    </ul>

                    <div class="tab-content" id="contactTabsContent">
                      <!-- Owner Tab -->
                      <div class="tab-pane fade show active" id="owner" role="tabpanel" aria-labelledby="owner-tab">
                        <div class="mt-3">
                          <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" value="" id="copyOwnerData">
                            <label class="form-check-label" for="copyOwnerData">
                              <strong>{{ __('Copy data to other contacts') }}</strong>
                            </label>
                          </div>
                          <div class="row">
                            <!-- First Column -->
                            <div class="col-md-6">
                              <div class="mb-3">
                                <label for="ownerFirstName" class="form-label required">{{ __('First Name') }}</label>
                                <input type="text" class="form-control" id="ownerFirstName" name="owner[first_name]" required>
                              </div>
                              <div class="mb-3">
                                <label for="ownerLastName" class="form-label required">{{ __('Last Name') }}</label>
                                <input type="text" class="form-control" id="ownerLastName" name="owner[last_name]" required>
                              </div>
                              <div class="mb-3">
                                <label for="ownerOrg" class="form-label">{{ __('Organization') }}</label>
                                <input type="text" class="form-control" id="ownerOrg" name="owner[org]">
                              </div>
                              <div class="mb-3">
                                <label for="ownerStreet1" class="form-label">{{ __('Street Address') }}</label>
                                <input type="text" class="form-control" id="ownerStreet1" name="owner[street1]">
                              </div>
                              <div class="mb-3">
                                <label for="ownerCity" class="form-label required">{{ __('City') }}</label>
                                <input type="text" class="form-control" id="ownerCity" name="owner[city]" required>
                              </div>
                            </div>

                            <!-- Second Column -->
                            <div class="col-md-6">
                              <div class="mb-3">
                                <label for="ownerSp" class="form-label">{{ __('State/Province') }}</label>
                                <input type="text" class="form-control" id="ownerSp" name="owner[sp]">
                              </div>
                              <div class="mb-3">
                                <label for="ownerPc" class="form-label">{{ __('Postal Code') }}</label>
                                <input type="text" class="form-control" id="ownerPc" name="owner[pc]">
                              </div>
                              <div class="mb-3">
                                <label for="ownerCc" class="form-label required">{{ __('Country') }}</label>
                                <select class="form-select" id="ownerCc" name="owner[cc]" required="required">
                                  {% for country in countries %}
                                    <option value="{{ country.alpha2|lower }}">{{ country.name }}</option>
                                  {% endfor %}
                                </select>
                              </div>
                              <div class="mb-3">
                                <label for="ownerVoice" class="form-label">{{ __('Phone') }}</label>
                                <input type="tel" class="form-control" id="ownerVoice" name="owner[voice]">
                              </div>
                              <div class="mb-3">
                                <label for="ownerEmail" class="form-label required">{{ __('Email') }}</label>
                                <input type="text" class="form-control" id="ownerEmail" name="owner[email]" required autocapitalize="none">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Billing Tab -->
                      <div class="tab-pane fade" id="billing" role="tabpanel" aria-labelledby="billing-tab">
                        <div class="mt-3">
                          <div class="row">
                            <!-- First Column -->
                            <div class="col-md-6">
                              <div class="mb-3">
                                <label for="billingFirstName" class="form-label required">{{ __('First Name') }}</label>
                                <input type="text" class="form-control" id="billingFirstName" name="billing[first_name]" required>
                              </div>
                              <div class="mb-3">
                                <label for="billingLastName" class="form-label required">{{ __('Last Name') }}</label>
                                <input type="text" class="form-control" id="billingLastName" name="billing[last_name]" required>
                              </div>
                              <div class="mb-3">
                                <label for="billingOrg" class="form-label">{{ __('Organization') }}</label>
                                <input type="text" class="form-control" id="billingOrg" name="billing[org]">
                              </div>
                              <div class="mb-3">
                                <label for="billingStreet1" class="form-label">{{ __('Street Address') }}</label>
                                <input type="text" class="form-control" id="billingStreet1" name="billing[street1]">
                              </div>
                              <div class="mb-3">
                                <label for="billingCity" class="form-label required">{{ __('City') }}</label>
                                <input type="text" class="form-control" id="billingCity" name="billing[city]" required>
                              </div>
                            </div>

                            <!-- Second Column -->
                            <div class="col-md-6">
                              <div class="mb-3">
                                <label for="billingSp" class="form-label">{{ __('State/Province') }}</label>
                                <input type="text" class="form-control" id="billingSp" name="billing[sp]">
                              </div>
                              <div class="mb-3">
                                <label for="billingPc" class="form-label">{{ __('Postal Code') }}</label>
                                <input type="text" class="form-control" id="billingPc" name="billing[pc]">
                              </div>
                              <div class="mb-3">
                                <label for="billingCc" class="form-label required">{{ __('Country') }}</label>
                                <select class="form-select" id="billingCc" name="billing[cc]" required="required">
                                  {% for country in countries %}
                                    <option value="{{ country.alpha2|lower }}">{{ country.name }}</option>
                                  {% endfor %}
                                </select>
                              </div>
                              <div class="mb-3">
                                <label for="billingVoice" class="form-label">{{ __('Phone') }}</label>
                                <input type="tel" class="form-control" id="billingVoice" name="billing[voice]">
                              </div>
                              <div class="mb-3">
                                <label for="billingEmail" class="form-label required">{{ __('Email') }}</label>
                                <input type="text" class="form-control" id="billingEmail" name="billing[email]" required autocapitalize="none">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- Abuse Tab -->
                      <div class="tab-pane fade" id="abuse" role="tabpanel" aria-labelledby="abuse-tab">
                        <div class="mt-3">
                          <div class="row">
                            <!-- First Column -->
                            <div class="col-md-6">
                              <div class="mb-3">
                                <label for="abuseFirstName" class="form-label required">{{ __('First Name') }}</label>
                                <input type="text" class="form-control" id="abuseFirstName" name="abuse[first_name]" required>
                              </div>
                              <div class="mb-3">
                                <label for="abuseLastName" class="form-label required">{{ __('Last Name') }}</label>
                                <input type="text" class="form-control" id="abuseLastName" name="abuse[last_name]" required>
                              </div>
                              <div class="mb-3">
                                <label for="abuseOrg" class="form-label">{{ __('Organization') }}</label>
                                <input type="text" class="form-control" id="abuseOrg" name="abuse[org]">
                              </div>
                              <div class="mb-3">
                                <label for="abuseStreet1" class="form-label">{{ __('Street Address') }}</label>
                                <input type="text" class="form-control" id="abuseStreet1" name="abuse[street1]">
                              </div>
                              <div class="mb-3">
                                <label for="abuseCity" class="form-label required">{{ __('City') }}</label>
                                <input type="text" class="form-control" id="abuseCity" name="abuse[city]" required>
                              </div>
                            </div>

                            <!-- Second Column -->
                            <div class="col-md-6">
                              <div class="mb-3">
                                <label for="abuseSp" class="form-label">{{ __('State/Province') }}</label>
                                <input type="text" class="form-control" id="abuseSp" name="abuse[sp]">
                              </div>
                              <div class="mb-3">
                                <label for="abusePc" class="form-label">{{ __('Postal Code') }}</label>
                                <input type="text" class="form-control" id="abusePc" name="abuse[pc]">
                              </div>
                              <div class="mb-3">
                                <label for="abuseCc" class="form-label required">{{ __('Country') }}</label>
                                <select class="form-select" id="abuseCc" name="abuse[cc]" required="required">
                                  {% for country in countries %}
                                    <option value="{{ country.alpha2|lower }}">{{ country.name }}</option>
                                  {% endfor %}
                                </select>
                              </div>
                              <div class="mb-3">
                                <label for="abuseVoice" class="form-label">{{ __('Phone') }}</label>
                                <input type="tel" class="form-control" id="abuseVoice" name="abuse[voice]">
                              </div>
                              <div class="mb-3">
                                <label for="abuseEmail" class="form-label required">{{ __('Email') }}</label>
                                <input type="text" class="form-control" id="abuseEmail" name="abuse[email]" required autocapitalize="none">
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <!-- IP Whitelisting Column -->
                  <div class="col-md-6 mb-3">
                    <div class="card h-100">
                      <div class="card-body">
                        <h5 class="card-title">{{ __('IP Whitelisting') }} <span class="text-red">*</span></h5>
                        <p class="card-text">
                          {{ __('Whitelist IP addresses for secure access. Up to 5 IP addresses (IPv4 or IPv6) can be added.') }}
                        </p>
                        <div id="ipWhitelistForm">
                          <div id="ipAddressFields">
                            <div class="mb-3 d-flex align-items-center">
                              <input type="text" class="form-control" name="ipAddress[]" autocapitalize="none" required>
                              <button type="button" class="btn btn-primary ms-2 add-ip">+</button>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <!-- Registrar User Column -->
                  <div class="col-md-6 mb-3">
                    <div class="card h-100">
                      <div class="card-body">
                        <h5 class="card-title">{{ __('Registrar User') }}</h5>
                        <p class="card-text">
                          {{ __('Create a registrar user by specifying the username (also known as CLID), email, and passwords for EPP and panel access.') }}
                        </p>
                        <div class="table-responsive">
                          <table class="table">
                            <thead>
                              <tr>
                                <th scope="col required">{{ __('Username/CLID') }} <span class="text-red">*</span></th>
                                <th scope="col">{{ __('Login Email') }} <span class="text-red">*</span></th>
                                <th scope="col">{{ __('Panel Password') }} <span class="text-red">*</span></th>
                                <th scope="col">{{ __('EPP Password') }} <span class="text-red">*</span></th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr>
                                <td>
                                  <input type="text" class="form-control form-control-sm" name="user_name" placeholder="user1" autocomplete="off" required autocapitalize="none">
                                </td>
                                <td>
                                  <input type="text" class="form-control form-control-sm" name="user_email" placeholder="user1@example.com" autocomplete="off" required autocapitalize="none">
                                </td>
                                <td>
                                  <input type="password" class="form-control form-control-sm" name="panelPassword" autocomplete="off" required>
                                </td>
                                <td>
                                  <input type="password" class="form-control form-control-sm" name="eppPassword" autocomplete="off" required>
                                </td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- OTE Section -->
                <div class="card mb-3">
                  <div class="card-body">
                    <h5 class="card-title">{{ __('Operational Test and Evaluation (OTE)') }}</h5>
                    <p class="card-text">
                      {{ __('Operational Test and Evaluation (OTE) assesses the functionality of EPP commands in a simulated environment, ensuring effective communication between the registrar\'s system and the registry. Below are key EPP commands and their test statuses:') }}
                    </p>
                    <div class="row">
                      <!-- First Column -->
                      <div class="col-md-6">
                        <ul class="list-group">
                          <li class="list-group-item d-flex justify-content-between align-items-center">
                            contact:create
                            <span class="badge bg-orange text-orange-fg">{{ __('Pending') }}</span>
                          </li>
                          <li class="list-group-item d-flex justify-content-between align-items-center">
                            domain:check
                            <span class="badge bg-orange text-orange-fg">{{ __('Pending') }}</span>
                          </li>
                          <li class="list-group-item d-flex justify-content-between align-items-center">
                            domain:info
                            <span class="badge bg-orange text-orange-fg">{{ __('Pending') }}</span>
                          </li>
                          <li class="list-group-item d-flex justify-content-between align-items-center">
                            domain:renew
                            <span class="badge bg-orange text-orange-fg">{{ __('Pending') }}</span>
                          </li>
                          <li class="list-group-item d-flex justify-content-between align-items-center">
                            domain:transfer
                            <span class="badge bg-orange text-orange-fg">{{ __('Pending') }}</span>
                          </li>
                        </ul>
                      </div>

                      <!-- Second Column -->
                      <div class="col-md-6">
                        <ul class="list-group">
                          <li class="list-group-item d-flex justify-content-between align-items-center">
                            host:create
                            <span class="badge bg-orange text-orange-fg">{{ __('Pending') }}</span>
                          </li>
                          <li class="list-group-item d-flex justify-content-between align-items-center">
                            host:info
                            <span class="badge bg-orange text-orange-fg">{{ __('Pending') }}</span>
                          </li>
                          <li class="list-group-item d-flex justify-content-between align-items-center">
                            contact:update
                            <span class="badge bg-orange text-orange-fg">{{ __('Pending') }}</span>
                          </li>
                          <li class="list-group-item d-flex justify-content-between align-items-center">
                            domain:delete
                            <span class="badge bg-orange text-orange-fg">{{ __('Pending') }}</span>
                          </li>
                          <li class="list-group-item d-flex justify-content-between align-items-center">
                            poll:request
                            <span class="badge bg-orange text-orange-fg">{{ __('Pending') }}</span>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="row align-items-center">
                      <div class="col-auto">
                        <button type="submit" class="btn btn-primary">{{ __('Create Registrar') }}</button>
                      </div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        {% include 'partials/footer.twig' %}
      </div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ipForm = document.getElementById('ipWhitelistForm');
    const maxFields = 5;

    ipForm.addEventListener('click', function(e) {
        const target = e.target;

        // Handle Add IP Button Click
        if (target.classList.contains('add-ip')) {
            const totalFields = ipForm.querySelectorAll('input[name="ipAddress[]"]').length;
            if (totalFields < maxFields) {
                const newField = target.parentElement.cloneNode(true);
                newField.querySelector('input').value = '';
                newField.querySelector('.add-ip').classList.replace('btn-primary', 'btn-danger');
                newField.querySelector('.add-ip').textContent = '-';
                newField.querySelector('.add-ip').classList.replace('add-ip', 'remove-ip');
                ipForm.querySelector('#ipAddressFields').appendChild(newField);
            }
        }

        // Handle Remove IP Button Click
        if (target.classList.contains('remove-ip')) {
            target.parentElement.remove();
        }
    });
    
    const copyCheckbox = document.getElementById('copyOwnerData');

    // Function to copy data to another tab
    function copyDataToTab(tabId) {
        const ownerInputs = document.querySelectorAll('#owner input:not([type="checkbox"]), #owner select');
        const targetFields = document.querySelectorAll(`${tabId} input:not([type='checkbox']), ${tabId} select`);

        ownerInputs.forEach((input, index) => {
            if (targetFields[index] && input.tagName === targetFields[index].tagName) {
                targetFields[index].value = input.value;
            }
        });
    }

    copyCheckbox.addEventListener('change', function() {
        if (this.checked) {
            copyDataToTab('#billing');
            copyDataToTab('#abuse');
        } else {
            // Clear fields when unchecked, if desired
            ['#billing', '#abuse'].forEach(tabId => {
                const fields = document.querySelectorAll(`${tabId} input:not([type='checkbox']), ${tabId} select`);
                fields.forEach(field => {
                    field.value = '';
                });
            });
        }
    });

});
</script>
{% endblock %}